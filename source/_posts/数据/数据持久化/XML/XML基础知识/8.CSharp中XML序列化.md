---
title: 8.CSharp中XML序列化
date: 2025-03-06 16:35:03
toc: true
categories:
  - 数据
  - 数据持久化
  - XML
  - XML基础知识

tags:
  - 数据
  - 数据持久化
  - XML
  - XML基础知识
---

# 什么是序列化？
将**对象状态**转换为可存储/传输的格式（如XML、JSON、二进制）的过程。
**游戏开发典型应用场景：**
1. 玩家存档/读档
2. 网络数据传输
3. 配置文件管理（如画质设置、按键绑定）
4. 对象池的持久化

**关键类和语法**
XmlSerializer Xml序列化器类：用于序列化对象为XML的关键类
StreamWriter 流写入器类：用于存储文件
{% post_link csharp的using语句 %}：用于方便流对象释放和销毁


## `StreamWriter`/`StreamReader`简单介绍
**所属命名空间**：`System.IO`  
**功能**：文本文件的读写操作
```cs
using System.IO;
using UnityEngine;

public class StreamWriterExample : MonoBehaviour
{
    void Start()
    {
        // 定义文件路径
        string filePath = Application.dataPath + "/example.txt";
        try
        {
            // 创建一个 StreamWriter 对象，指定文件路径和编码格式
            using (StreamWriter writer = new StreamWriter(filePath, false, System.Text.Encoding.UTF8))
            {
                // 写入一行文本
                writer.WriteLine("Hello, World!");
                // 写入另一行文本
                writer.WriteLine("This is a test.");
            }

            Debug.Log("文件写入成功！");
        }
        catch (System.Exception e)
        {
            Debug.LogError("文件写入失败：" + e.Message);
        }
    }
}
```

## XmlSerializer 简单介绍
**所属命名空间**：`System.Xml.Serialization`
**序列化**：当你使用 `XmlSerializer` 对一个对象进行序列化时，它会反射对象的类型信息，查找对象的公共属性和字段，并根据这些信息生成相应的 XML 元素和属性。序列化过程会将对象的属性值转换为 XML 文本，然后将这些 XML 文本写入到指定的流（如文件流、内存流等）中。
```cs
// 创建 XmlSerializer 对象，指定要序列化的类型
XmlSerializer serializer = new XmlSerializer(typeof(Person));

// 创建一个 StreamWriter 对象，用于将 XML 数据写入文件
using (StreamWriter writer = new StreamWriter(filePath))
{
    // 执行序列化操作 (第一个参数是文件流对象，第二个是想要序列化的对象)
    serializer.Serialize(writer, person);
}
```

# XML序列化
**注意：**
1. 只能序列化公共成员
2. 不支持字典序列化
3. stream相关和using相关
4. 序列化时，对象中的引用成员为空，那么序列化后的xml里面是看不到该字段的

```cs
[Serializable]
public class PlayerData
{
    [XmlAttribute("id")]  // 作为XML属性
    public int PlayerID;
    
    [XmlElement("name")]  // 作为XML元素 节点名为name
    public string PlayerName;
    
    public Vector3 Position;  // 需要特殊处理的结构体
    
    [XmlIgnore]  // 忽略不需要序列化的字段
    public bool IsDirty;

    [XmlArray("IntList")]
    [XmlArrayItem("Int32")]
    public List<int> listInt = new List<int> { 1, 2, 3, 4 };
}
```

```cs
public void SavePlayerData(PlayerData data, string path)
{
    XmlSerializer serializer = new XmlSerializer(typeof(PlayerData));
    using (StreamWriter writer = new StreamWriter(path))
    {
        serializer.Serialize(writer, data);
    }
}
```
