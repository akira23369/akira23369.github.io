---
title: 8.反射读取常用成员数据
date: 2025-02-24 10:40:15
toc: true
categories:
  - 数据
  - 数据持久化
  - PlayerPrefs
  - PlayerPrefs实践项目

tags:
  - 数据
  - 数据持久化
  - PlayerPrefs
  - PlayerPrefs实践项目
---

```cs
public object Load(Type type, string key)
    {
        object v = Activator.CreateInstance(type);
        FieldInfo[] fieldInfos = type.GetFields();
        string loadKey = null;
        for (int i = 0; i < fieldInfos.Length; i++)
        {
            FieldInfo tmp = fieldInfos[i];
            loadKey = $"{key}_{type.Name}_{tmp.FieldType.Name}_{tmp.Name}";
            // 给v对象的字段赋值
            tmp.SetValue(v, LoadValue(tmp.FieldType, loadKey));
        }
        return v;
    }
```

```cs
// 得单个数据
private object LoadValue(Type fieldType, string key)
{
    //object v = Activator.CreateInstance(fieldType);
    // 根据字段类型调用不同API
    if (fieldType == typeof(int))
    {
        return PlayerPrefs.GetInt(key, 0);
    }
    else if (fieldType == typeof(float))
    {
        return PlayerPrefs.GetFloat(key, 0);
    }
    else if (fieldType == typeof(string))
    {
        return PlayerPrefs.GetString(key, null);
    }
    else if (fieldType == typeof(bool))
    {
        return PlayerPrefs.GetInt(key) == 1;
    }
    else
    {
        return null;
    }
}
```


```cs
// 测试代码
Player p = PlayerPrefsDataMgr.Instance.Load(typeof(Player), "player") as Player;
```


