---
title: 38.反向动力学IK
date: 2025-03-19 10:04:23
toc: true
categories:
  - 游戏引擎
  - unity
  - unity核心

tags:
  - 游戏引擎
  - unity
  - unity核心
  - 动画系统
  - 核心系统
  - 2d动画
  - 2d骨骼动画
  - 2d Animation
---

# 什么是IK
![](38.反向动力学IK/0b16ba3c4c1d2db13641b1849d7cee4f.gif)
在骨骼动画中，构建骨骼的方法被称为正向动力学。
它的表现形式是，子骨骼（关节）的位置根据父骨骼（关节）的旋转而改变。
用我们人体举例子，当我们抬起手臂时，是肩部关节带动的整个手臂的运动，用父子骨骼理解的话就是父带动了子。

而IK全称是Inverse Kinematics，翻译过来的意思就是反向动力学的意思。
它和正向动力学恰恰相反。
它的表现形式是，子骨骼（关节）末端的位置改变会带动自己以及自己的父骨骼（关节）旋转。
用我们人体举例子，当我们拿起一个杯子的时候是用手掌去拿，以杯子为参照物，我们移动杯子的位置，手臂会随着杯子一起移动，用父子骨骼理解的话就是子带动了父。

# 2DIK包引入
2022版本自带有
![](38.反向动力学IK/file-20250319110212808.png)

# 2DIK的使用
先给权杖也弄骨骼
![](38.反向动力学IK/file-20250319110517069.png)

新建一个空物体作为根对象，拖PSB图片做成子物体，给根物体添加IKManager2D组件
![](38.反向动力学IK/file-20250319172851394.png)


## IK相关脚本参数
![](38.反向动力学IK/IK知识点.png)
### IK Manager 2D 脚本参数
IK Solvers：IK解算器，在这里添加IK
 ![](38.反向动力学IK/file-20250319111501368.png)
Chain（CCD）：可以自定义影响N个关节点，不能反向
Chain（FABRIK）：可以自定义影响N个关节点，可以反向 
Limb：只会影响3个关节点，一般四肢选这个
Weight：权重，当有多个IK控制同一点时权重会影响控制的百分比
Restore Default Pose：回复默认位置

给左右手和脚的末端和权杖的末端添加空物体，会利用这些空物体在对应位置添加IK点


![](38.反向动力学IK/file-20250319111842235.png)


在根对象的IKManager2D组件点击加号添加一个Chain（CCD）类型的IK，添加完会出现一个New CCDSolver2D子物体挂载NCCDSolver2D脚本
![](38.反向动力学IK/file-20250319112232002.png)

![](38.反向动力学IK/file-20250319155451847.png)

### CCD Solver 2D参数

![](38.反向动力学IK/file-20250319155551130.png)


将权杖末端的空对象赋值进来。
![](38.反向动力学IK/file-20250319160227279.png)

Chain Length：IK影响的骨骼数量，往上影响多少个骨骼节点，加大数值，点变成绿色就意味着影响了那个骨骼。
Iterations：算法运行的次数。
Tolerance：容错程度。
Velocity：速度。

点击创建对象，会出来一个对象并关联，这个对象可以理解为创建出来的IK节点，通过这个IK节点反向控制骨骼，现在移动子物体因为有了IK父物体也会跟着动。
![](38.反向动力学IK/file-20250319160749996.png)

![](38.反向动力学IK/file-20250319160652843.png)


Effector：默认的IK点位置
Target：会根据IK点位置生成真正的IK点对象 
Flip：反向 
Constrain Rotation：约束旋转程度 
Solve from Default Pose：从默认姿势进行求解计算 
Weight：权重


CCD模式不能完全反向。
![](38.反向动力学IK/file-20250319161411037.png)

但FABRIK模式可以
![](38.反向动力学IK/file-20250319161555150.png)
和上面ccd模式基本一样操作
![](38.反向动力学IK/file-20250319161756752.png)


![](38.反向动力学IK/file-20250319161632339.png)



### LimbSolver2D脚本参数
![](38.反向动力学IK/file-20250319161504740.png)

Effector：默认的IK点位置。
Target：会根据IK点位置生成真正的IK点对象。
Flip：反向。
Constrain Rotation：约束旋转程度。
Solve from Default Pose：从默认姿势进行求解计算。
Weight：权重。
Create Target：创建IK节点。
Restore Default Pose：重置默认形状。

为人物四肢创建IK
![](38.反向动力学IK/file-20250319161726989.png)

![](38.反向动力学IK/file-20250319162003471.png)

其实四肢也可以往上控制多个点的
先把左手这个删掉，重新选一个IK解算器
![](38.反向动力学IK/file-20250319171643713.png)
![](38.反向动力学IK/file-20250319171831398.png)

![](38.反向动力学IK/file-20250319171929083.png)

还可以改受IK点影响的到的骨骼颜色
![](38.反向动力学IK/file-20250319172041294.png)
下面的效果是一拳带动全身
![](38.反向动力学IK/file-20250319172134326.png)

![](38.反向动力学IK/file-20250319172216601.png)

现在IK点不会跟着人物的根骨骼动，而是锁死在原地如下。想要一起动的话把各个IK点放到根骨骼下就行
![](38.反向动力学IK/file-20250319172428852.png)

![](38.反向动力学IK/file-20250319172540117.png)


![](38.反向动力学IK/file-20250319172634470.png)



# IK对于我们的意义
瞄准功能。
头部朝向功能。
拾取物品功能等等有指向性的功能时，我们都可以通过IK来达到目的。
最大的作用，可以方便我们进行动画制作。



# 练习
请制作一个鼠标指向哪，2D人物的手臂就指向哪里的功能

创建空物体，拖psb文件图片进来，在左手添加一个空物体
![](38.反向动力学IK/file-20250319173123446.png)


选择空对象，添加IKManager2D脚本，添加一个IK，选择四肢用的Limb。会创建一个IK位置节点
![](38.反向动力学IK/file-20250319173148368.png)


在IK位置节点关联左手空物体，点击创建目标按钮，生成IK目标对象
![](38.反向动力学IK/file-20250319173208855.png)


制作思路：我们可以控制IK目标对象的位置移动手臂，那么只要用鼠标控制IK目标对象就行了
![](38.反向动力学IK/file-20250319173429404.png)


```cs
public Transform ikPoint; //IK点的位置
private float z; //2D游戏所在平面的z轴坐标
private Vector3 mousePos;

void Start()
{
    z = Camera.main.WorldToScreenPoint(ikPoint.position).z; 
}

void Update()
{
    if (Input.GetMouseButton(0))
    {
        mousePos = Input.mousePosition;
        mousePos.z = z;
        ikPoint.position = Camera.main.ScreenToWorldPoint(mousePos);
    }
}
```

