---
title: 28.碰撞检测之碰撞检测函数
date: 2025-02-20 19:22:55
toc: true
categories:
  - 游戏引擎
  - unity
  - unity入门
  - unity入门基础知识

tags:
  - 游戏引擎
  - unity
  - unity入门
  - unity入门基础知识
  - 核心系统
  - 物理系统
---

注意:碰撞和触发响应函数 属于 特殊的生命周期函数 也是通过反射调用
![](28.碰撞检测之碰撞检测函数/生命周期函数图.bmp)
ps：
只要挂载的对象能和其它物体产生碰撞检测才会响应下面的函数
如果是一个异形物体，刚体在父对象上，如果你想通过子对象上挂脚本检测碰撞是不行的，必须挂载到这个刚体父对象上才行。
# 物理碰撞检测响应函数
```csharp
private void OnCollisionEnter(Collision collision)
{
	// Collision类   (碰撞信息类

	// 碰撞到的对象碰撞器的信息
	Collider collider1 = collision.collider;

	// 碰撞到的对象的所依附的对象    (GameObject)
	GameObject gameObject1 = collision.gameObject;

	// 碰撞到的对象的transform组件信息
	Transform transform1 = collision.transform;

	// 触碰点数相关   接触点具体坐标
	ContactPoint[] contacts = collision.contacts;

	print($"我被{collision.gameObject.name}碰撞到了");

}

// 碰撞结束分离时, 自动执行
private void OnCollisionExit(Collision collision)
{
	print($"我和{collision.gameObject.name}碰撞分离了");
}

// 两个物体相互摩擦时会不停调用该函数
private void OnCollisionStay(Collision collision)
{
	print($"我和{collision.gameObject.name}一直在产生摩擦");
}
```


# 触发器检测响应函数
```csharp
// 触发开始时会自动调用该函数    (传入的是Collider脚本对象)
private void OnTriggerEnter(Collider other)
{
	print($"我被{other.gameObject.name}触发了");
}

// 当Stay结束时调用
private void OnTriggerExit(Collider other)
{
	print($"我被{other.gameObject.name}结束触发了");
}

// 当两触发器相交会不停调用
private void OnTriggerStay(Collider other)
{
	print($"我被{other.gameObject.name}水乳相融");
}
```

**碰撞和触发器函数都可以写成虚函数，在子类去重写逻辑**
- 一般会把想要重写的碰撞和触发检测函数写成protected保护类型的，加上virtual变成虚函数。
- 没有必要写成public，因为不会自己手动调用碰撞和触发检测函数，都是Unity通过反射帮助我们自动调用的。

# 小练习
在之前Input和Screen中的练习题基础上，加入一个点击鼠标左键可以发射一颗子弹飞出的功能

**给坦克添加一个炮口空物体当做子弹飞出来的位置**
**添加点击飞出子弹代码，创建子弹预设体，拖拽赋值炮口空物体和子弹预设体**
```cs
//Update内 
if (Input.GetMouseButtonDown(0)) 
{ 
    //实例化一个子弹对象 
    GameObject obj = Instantiate(bulletObj); 
    //设置对象的位置 
    obj.transform.position = bulletPos.position; 
    //设置对象的角度 
    obj.transform.eulerAngles = bulletPos.eulerAngles; 
}
```
**子弹一直飞**
```cs
//Update内 //子弹一直往前飞 
this.transform.Translate(Vector3.forward * moveSpeed * Time.deltaTime);
```


加入子弹触碰到地面会自动消失的功能
```cs
private void OnTriggerEnter(Collider other)
{
    //问题一：如果发射子弹时  和坦克自身的碰撞和重合了 可能一开始 就会被移除
    //解决方案：判断自己碰撞到的对象 是什么 一定是特定对象 才移除自己
    if (other.gameObject.CompareTag("Ground") ||
        other.gameObject.CompareTag("Monster"))
    {
        //碰撞到别的东西 就让子弹小时
        //一定是移除自己依附的GameObject对象 而不是脚本自己
        Destroy(this.gameObject);
    }

    //问题二：坦克本身就带有碰撞盒  当子弹和坦克自身的碰撞盒碰撞可能会产生力的作用 出现一些意想不到的效果
    //解决方案：把子弹做成触发器 这样就没有了力的作用
}
```

```cs
public int HP = 3;

//当子弹碰到我时  就减血 血量为0了 就移除
private void OnTriggerEnter(Collider other)
{
    //由于场景上 只有子弹时触发器 所以我们可以不用进行任何判断 就可以完成这个功能
    //减血
    HP -= 1;
    //为0就移除自己
    if (HP <= 0)
    {
        Destroy(this.gameObject);
    }
}

```